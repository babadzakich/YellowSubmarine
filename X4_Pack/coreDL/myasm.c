#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <dlfcn.h> 
#include "decls.h"                                           // хедер с функциями работы с .so

typedef void (*FuncType_0)(State*);
typedef void (*FuncType_1)(State*, char*);
typedef void (*FuncType_2)(State*, char*, char*);
typedef void (*FuncType_3)(State*, char*, char*, char*);
typedef void (*FuncType_4)(State*, char*, char*, char*, char*);
typedef void (*FuncType_5)(State*, char*, char*, char*, char*, char*);



// char plugin[10000];
// char pluginName[10000];
// char function_name[10000];
// char text[10000];


int main(void)
{   
    // FILE *in, *out;
    // in = fopen("input.txt", "r");
    // freopen("output.txt", "w", stdout);
    State state;
    char text[10000];
    while(fgets(text, 10000, stdin) != NULL)
    {
        int flag = 0;
        for(char* step = text; *step != '\0'; step++)
        {
            if (*step == '\n' || *step == '\r')
            {
                *step = '\0';
            }
            if (*step == ':') flag = 1;
        }
        
        char* lexem = strtok(text, " :");
        char* plugin;
        char* pluginName;
        char* function_name;
        if (flag)
        {
            plugin = (char*)malloc(strlen(lexem) + 6);
            sprintf(plugin, "./%s.so", lexem);
            pluginName = strdup(lexem);
            lexem = strtok(NULL, " :");
            function_name = strdup(lexem); 
        }
        else
        {
            plugin = strdup("./core.so");
            pluginName = strdup("core");
            function_name = strdup(lexem);
        } 

        
        lexem = strtok(NULL, " :");
        char* data[7];
        char* func = (char*)malloc(strlen(function_name) + 3);
        int functiones_amount = 0;
        while(lexem != NULL && functiones_amount <= 3)
        {
            data[functiones_amount++] = strdup(lexem);
            lexem = strtok(NULL, " :");
        }
        sprintf(func, "%s_%d",function_name, functiones_amount);


        void *hDll = dlopen(plugin, RTLD_LAZY);                   // подключаем .so-библиотеку с заданным именем
        if(hDll == NULL)
        {
            printf("Missing plugin %s\n", pluginName);
            continue;
        }

        FuncType_0 myfunc_0;
        FuncType_1 myfunc_1;
        FuncType_2 myfunc_2;
        FuncType_3 myfunc_3;
        FuncType_4 myfunc_4;
        FuncType_5 myfunc_5;
        if(functiones_amount == 0)
        {
            myfunc_0 = (FuncType_0)dlsym(hDll, func);
            if (myfunc_0 == NULL)
            {
                printf("Missing function %s in plugin %s\n", func, pluginName);
            }
            else
            {
                myfunc_0(&state);
            }
        }
        else if(functiones_amount == 1)
        {
            myfunc_1 = (FuncType_1)dlsym(hDll, func);
            if (myfunc_1 == NULL)
            {
                printf("Missing function %s in plugin %s\n", func, pluginName);
            }
            else
            {
                myfunc_1(&state, data[0]);
            }
        }
        else if (functiones_amount == 2)
        {
            myfunc_2 = (FuncType_2)dlsym(hDll, func);
            if (myfunc_2 == NULL)
            {
                printf("Missing function %s in plugin %s\n", func, pluginName);
            }
            else
            {
                myfunc_2(&state, data[0], data[1]);
            }
        }
        else if (functiones_amount == 3)
        {
            myfunc_3 = (FuncType_3)dlsym(hDll, func);
            if (myfunc_3 == NULL)
            {
                printf("Missing function %s in plugin %s\n", func, pluginName);
            }
            else
            {
                myfunc_3(&state, data[0], data[1], data[2]);
            }
        }
        else if (functiones_amount == 4)
        {
            myfunc_4 = (FuncType_4)dlsym(hDll, func);
            if (myfunc_4 == NULL)
            {
                printf("Missing function %s in plugin %s\n", func, pluginName);
            }
            else
            {
                myfunc_4(&state, data[0], data[1], data[2], data[3]);
            }
        }
        dlclose(hDll);    
        memset(text, '\0', sizeof(text));
        free(plugin);
        free(func);
    }

}



// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@%                                                 .,*, .***//////******************************,                                                 &@
// @@@%                                           *//////**,. .,*///(((/*********************************///.                                          &@
// @@@%                                     .**///////////**,. ,**/((###/**********************************//////*                                     &@
// @@@%                                 .******//((((((((//**,..,**/((###/*********,************************//////////.                                &@
// @@@%                             .***********((###((((///*,,..,**/((###(***********************************//////////(/                             &@
// @@@%                          ,************,*/(####((((///*,,..,**/((###/*****,,,*****************************//////////((.                         &@
// @@@%                       ,****,*****,,,,,,,*/(###(((((//**,,..,**/((###/*,,,,,,,,,,,,,***********************////////////((,                      &@
// @@@%                    .***,***,*,,,,,,,,,,,,*/####(((((//**,,..,*//((###/*,,,,,,,,,,,,,,*,,********************////////////((/                    &@
// @@@%                  ,*****,,,,,,,,,,,,,,,,,,,*/(###(((((//**,...,**/((###/,,,,,,,,,,,,,,,,,,********************//////////////((,                 &@
// @@@%               .****,,,,,,,,,,,,,,,,,,,,,,,,*/((##(((((//**,,..,**/((###/,,,,,,,,,,,,,,,,,,,,,,,***************//////////////((((               &@
// @@@%             .**,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*/((##(((((//**,,..,**/((###/,,,,,,,,,,,,,,,,,,,,,,,****************/////////////(((((             &@
// @@@%            ***,*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*/((#(((((///**,,..,**/((###/,,,,,,,,,,,,,,,,,,,,,,,,*,*************///////////////(((/           &@
// @@@%          ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*/(##(((((///**,,..,**/((###/,,,,,,,,,,,,,,,,,,,,,,,,,**************///////////////((((*         &@
// @@@%        ,*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*/((#((((////**,,.,,**/((###/,,,,,,,,,,,,,,,,,,,,,,,,,,,***********/////((///(#####(####        &@
// @@@%       ,*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*/(((((((////**,,,,,**/((###/,,,,,,,,,,,,,,,,,,,,,,,,,,,,***********//(####%%########%%%(      &@
// @@@%     .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.,.,,,*((((((((///***,,,,,**/(((##/,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,**********#%%%%(%%##%##%%#%%&%     &@
// @@@%    .,,,,,,,.,,,,,,,,,,,,.........................,*((((((((///**,,,,,,**/((###/,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,********//#%%%%%%#%%###%%##%%&.   &@
// @@@%   .........,,,*(##%%%%%%%%##(//**,,................*(((((((////***,,,,,*//((###/,,,,,,,,,,,,,,,,,,,,,,,,,,,,,**********/(#%%%%%%%%####%%##%&,  &@
// @@@%  ..,,,,,.,*(%%&&&&%&%%&&&&%%%%%%%%%%%(*,...........,*((((((((///***,,,,,**/(((##/,,,,,,,,,,,,,,,,,,,,,,,,,,,,,**********//(#%(%%%&&&%%%%%%%%#. &@
// @@@% .,.,,*,,*#&&&&&&%%%%%%%%%%%%##%%%%###%%%%#/,.........*(((((((////**,,,,,,**/((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*********///#%%%%%%&&%%%%####.&@
// @@@%.,....,/#%&&&&%&&&&%%%%##############%%%####%#*........*(((((((////**,,,,,**//((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,**********///#%%%&&&&&&%%%%%(&@
// @@@%.,,.,/%%%&&&%%%%%%%%#######((((((/////((#%%##%#(,.......*(((((((////**,,,,,,*//(((##*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,**********////(###%%%%%&%##((@@
// @@@&..,,/(%%%&%%#########(#####(((((//***///////((#%#,......./(((((((///***,,,,,**//((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,********/////(((##%%%%%#((@@
// @@@&.,,*#%%&&%#//***//////////////*****/(##%#####((#%%(......./((((((/////**,,,,,**//((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,**********////(((#(((#((((@@
// @@@&.,/%&&&&%(/**********,*,,,,,***//(#%%%(/////((((/#%(......,/(((((((///***,,,,,**//((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*********////((((///((((@@
// @@@&.,#%&&&%(/********************//(##((///**/((((////#,......,/((((((////***,,,,,**//((###*,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,*********////((///////(@@
// @@@&.*%&&&%%(/*****///(((#((((((//**/((((((#%%%###(//////,*/##*.,/((((((////***,,,,,**//((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*********////////////(@@
// @@@&.,#&&%%##//**/(###########((/****////((((///********//((((/,.,/(((((((///***,,,,,**//((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,**********////////////@@
// @@@&..*#%%%%#(///(((//*****/(((/////***/////************///////,..,/(((((((///***,,,,,**//((###*,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,********///////////@@
// @@@&...*%%%%%#///((////*/(#(/(//*///****/////************///#&(,...,/((((((////***,,,,,**//((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*********//////////@@
// @@@&..../%%%%#(/////((###%#(/*****///((((&&%((*************//%(,...,,/((((((////***,,,,***//((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,********/////////@@
// @@@&...../%%%%#/****/((//*****,,,*//#&&(//*////***********/////,.....*(((((((///***,,,,,***//((###*,,...,,,,,,,,,,,,,,,,,,,,,,,,,,,,********////////@@
// @@@&.......*%%%#/*************,,,*/(((/********////////////////,.....,*/((((((////**,,,,,**//(((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*********///////@@
// @@@&........,/%%#***********,,,,,,***********/////((((////((///,,,,,..,*((((((((//***,,,,,**//(((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,**********//////@@
// @@@&......,,,**/(#**********,,,,,****/////((//////////////((/((/,.,..,,,*((((((((//***,,,,,**//(((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,**********/////@@
// @@@&......,/##((((#/**********,,****//((//***///////(((((#((((((,,,...,,,/((((((((//***,,,,***//(((###*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,**********////@@
// @@@&.....,,*/((///#&(************///(/****//////(((((((##%#####(,.,,..,,,,/(((#(((///**,,,,,***//((####*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,**********///@@
// @@@%.....,,,,***/%&&&#*****************/////////((((####%%%%###/,,,,,.,,,,,/(((#(((///**,,,,,***//((##%#*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,***********/&@
// @@@% ....,,,,,,***(###(/*****/////**/////((((((((((#####%%%%%%#,,,,,,.,,,,,,/(##(((((//**,,,,,**///((##%%*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,***********.&@
// @@@%  ...,,,,,,*,******///////*/////((((((#####(((((#####%%%%%#*,,,,,,,,,,,,,(####((((//**,..,***//(((###%*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*********, &@
// @@@%   ..,,,,,,,,********////////((((###((###(##((((###%%%%%&%#/,,,,,,,,,,,,,,(####((((//**,..,***//(((##%#,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,********,  &@
// @@@%    .,,,,,,,,,********/(((((((#################%%%%%&&&&%#(/,,,,,,,,,,,,,,,(####((((///*,..,***//(((##%%,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*,*****,   &@
// @@@%     .,,,,,,,,,********/(###########%%####%%%%%&%&&%%%%%#(//*,,,,,,,,,,,,,,,(#####(((///*,.,,**///((###%#,,,,,,,,,,,,,,,,,,,,,,,,,,,,******.    &@
// @@@%      .,,,,,,,,,*********//((#%%%%%%%%%%%%%%%%%%%%%####((////,,,,,,,,,,,,,,,,(%####(((///*,.,,**///((###%#,,,,,,,,,,,,,,,,,,,,,,,,,,,,****      &@
// @@@%        ,,,,,,,,***************/(((#######%#########((((//////**,,,,,,,,,,,,,,(%####(((///*,.,***//(((###%(,,,,,,,,,,,,,,,,,,,,,,,,,,,,*,       &@
// @@@%         .,,,,,***********************////////////////(///////#%%%#####%#/,,,,*(%####(((///*,,,***//((####%(,,,,,,,,,,,,,,,,,,,,,,,,,,,         &@
// @@@%           ,,,,*,,*/******/*****************//////////////////(%%%%%%###%%%%%###%%####((((//*,,,**///((####%/,,,,,,,,,,,,,,,,,,,,,,,,.          &@
// @@@%             ,/(########(/***/*****************///////////**//(#%%%%%%####%%%%%%#%%%####(((//**,***//(((###%%/,,,,,,,,,,,,,,,,,,,,,.            &@
// @@@%               #######%########((//******///////((((#####(###%%%%%%%%%%########%%%##%%###(((///****///(((##%%%*,,,,,,,,,,,,,,,,,,,              &@
// @@@%                 (#%###%%#############%###%%%%%%%%%%%%%%%&&&%%%%%%%%%%%%##########%###%####(((//****///((###%%%*,,,,,,,,,,,,,,,.                &@
// @@@%                   ,#%%##%%###################%%%%%%%%%%%%&%%%%%%%%%%%%%%%%############%####(((//***///(((###%%#,,,,,,,,,,,,,                   &@
// @@@%                      (%%%#%%###################%%%%%%%%%%%%%%%%%%%%%%%%%%%%############%####(((//***///(((###%%(,,,,,,,,,                      &@
// @@@%                         #%%#%%%##############%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%######(#####((((////////((###%%%(,,,,,.                        &@
// @@@%                            /#%%%%%#############%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%###(#####(((/////////((###%%%/,                            &@
// @@@%                                #%##%%#########%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#(#####(((////////(((###/                               &@
// @@@%                                    (%%%%%####%%%%%%%%%%%%%%%%%%%%%&&%%%%%%%%%%%%%%%#%%%########(((//(////(/,                                   &@
// @@@%                                        .(%##%%%%%%%%%%%%%%%%%%%%%%&&&%%%%%%%%%%%%%%%%%%%%##(###(((////.                                        &@
// @@@%                                               /#%%%%%%%%%%%%%%%%%%&&&&%%&%%%%%%%%%%%%%%%%%#####/,                                              &@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@/*************&@@@@@@@@@@@@@@@@@@@@@@.&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&.@@
// @@@@@@@@(.#@@@@,..@@@@@@@@@@@@@@@@@&.....,(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@..@@&..@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,./@@..%@@@@@#.....,#@@@
// @@@@@@@@%.@@@@@,..@@@@@@@@@@@@@@@@#.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*,@@@@@@@@@@
// @@@@@@@@#.@@@@@,..@@@@@/.,@@&..&@@.%.,@@&..&@@@/.../&%..%@@@@..*@@@@@@@*.,@@@@%..&@@@&..%@@@@@@@@@@/..&@%..,@@@#.*@@@. /@@@@@..(@@@@../@@@.%./@@&..@@@
// @@@@@@@@.*@@@@@,..@@@@*..@@@@@..&@...@@@@@..%@@&..@@@@@. #@@@../&&@@@@@*.*@@@@&..@@@.%..@@@@@@@@@@@(.,@@@,.*@@@&,(@@&/..@@@@@..%@@,/..#@@&..*@@@@&..@@
// @@@@@@@*.@@@@@@,..@@@@,..@@@@@..&@,..@@@@@. %@@&..@@@@@..#@@@..(@@@..*@*.*@@@@&..#.@@&..@@@@@@@@@@@(..@@@(..@@@*.*@@@#..@@@@@..%.%@@..#@@@../@@@@&..@@
// @@@@&*.&@@@@@@@,..%@@@@*.*@@@..&@@@*.*@@@..&@@@&...&@@..%@@@@../@@&..(@*.,@@@@%. @@@@&..@@@@@@@@@@@/ .@@@/..@@&..#@@/...@@@@@..%@@@@..(@@@@,.(@@&..@@@
// @@@..(@@@@@@@@@@@%..%@@@@@@@@@@@@@@@@@@@@@@@@@@&..@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@.#@@@@@@@@@@@@@@.%@@@@@@@@@@@@@@@@@@@@@@@@@.....,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@